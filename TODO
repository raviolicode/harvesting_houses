Gallito.com

Steps I did to get stuff from Gallito:

require 'rubygems'
require 'nokogiri'
require 'mechanize'
require 'open-uri'
url = "http://www.gallito.com.uy/Propiedades_Mapa"
agent = Mechanize.new
page = agent.get(url)
page.forms.first['__EVENTTARGET'] = 'Chkbar$53'
page.forms.first['__EVENTARGUMENT'] = ''
page.forms.first.checkbox_with(:name => 'Chkbar$53').check
p = page.forms.first.submit()

doc = Nokogiri::HTML(p.body)
doc.search('script').find('src~=WebResource')

p.body has all the data we need!!!

BUT there's another problem:

El gallito changes the url's every week, so some url's may need to change some part of the path in order to make them valid.
I think when the url is www.gallito.com.uy/:date/inmuebles-[:id]-[...].html
Then date should be ddMMyy 
Note: the date it's the date of the day of the sunday of the last week (porque sale los domingos, por lo que la fecha es del domingo, pero si se quiere consultar el mismo domingo, hay que buscar en la edicion anterior).

For example:

On the results, it appears this url: 
http://www.gallito.com.uy/01011/inmuebles-5923453-mapa.html
Then the valid url should be:
http://www.gallito.com.uy/20032011/inmuebles-5916586-Montevideo.html



